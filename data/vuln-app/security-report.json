{
  "totalRoutes": 5,
  "routesWithSinks": 6,
  "routesWithoutAuth": 2,
  "vulnerableRoutes": [
    {
      "route": "data\\vuln-app\\app\\api\\tasks\\route.ts",
      "methods": [
        "POST"
      ],
      "vulnerability": "Missing Authentication",
      "severity": "high",
      "description": "POST handler performs database writes without authentication checks"
    },
    {
      "route": "data\\vuln-app\\app\\api\\tasks\\[id]\\route.ts",
      "methods": [
        "DELETE"
      ],
      "vulnerability": "Missing Authentication",
      "severity": "high",
      "description": "DELETE handler performs database writes without authentication checks"
    },
    {
      "route": "data\\vuln-app\\app\\api\\tasks\\user-safe\\route.ts",
      "methods": [
        "GET"
      ],
      "vulnerability": "Missing Role Check",
      "severity": "high",
      "description": "GET handler reads user table without role-based authorization"
    },
    {
      "route": "data\\vuln-app\\app\\api\\tasks\\user\\route.ts",
      "methods": [
        "GET"
      ],
      "vulnerability": "Missing Role Check",
      "severity": "high",
      "description": "GET handler reads user table without role-based authorization"
    }
  ],
  "routes": [
    {
      "filePath": "data\\vuln-app\\app\\api\\tasks\\route.ts",
      "method": [
        "GET",
        "POST"
      ],
      "sinks": [
        {
          "type": "database_write",
          "location": "Line 29",
          "callPath": [
            "db.task.create"
          ]
        }
      ],
      "hasAuthentication": true,
      "authorizationChecks": [],
      "parameters": [
        {
          "name": "title",
          "source": "body",
          "containsObjectId": false
        },
        {
          "name": "description",
          "source": "body",
          "containsObjectId": false
        },
        {
          "name": "userId",
          "source": "body",
          "containsObjectId": true
        }
      ],
      "middleware": [],
      "methodDetails": [
        {
          "method": "GET",
          "sinks": [],
          "hasAuthentication": true,
          "authorizationChecks": []
        },
        {
          "method": "POST",
          "sinks": [
            {
              "type": "database_write",
              "location": "Line 29",
              "callPath": [
                "db.task.create"
              ],
              "isProtected": false
            }
          ],
          "hasAuthentication": false,
          "authorizationChecks": []
        }
      ]
    },
    {
      "filePath": "data\\vuln-app\\app\\api\\debug\\route.ts",
      "method": [
        "DELETE"
      ],
      "sinks": [
        {
          "type": "database_write",
          "location": "Line 38",
          "callPath": [
            "deleteUserData"
          ]
        }
      ],
      "hasAuthentication": true,
      "authorizationChecks": [
        {
          "type": "role_check",
          "location": "Line 14",
          "details": "function checkSuperuser(userRole: string) {\r\n  //custom role from config\r\n  return userRole === \"sup"
        },
        {
          "type": "role_check",
          "location": "Line 16",
          "details": "return userRole === \"superuser\" || userRole === \"moderator\";"
        },
        {
          "type": "session_check",
          "location": "Line 21",
          "details": "const session = await getServerSession();"
        },
        {
          "type": "session_check",
          "location": "Line 23",
          "details": "if (!session) {\r\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n  }"
        },
        {
          "type": "session_check",
          "location": "Line 31",
          "details": "if (!checkSuperuser(session.user.role)) {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { st"
        }
      ],
      "parameters": [],
      "middleware": [],
      "methodDetails": [
        {
          "method": "DELETE",
          "sinks": [
            {
              "type": "database_write",
              "location": "Line 38",
              "callPath": [
                "deleteUserData"
              ],
              "isProtected": true
            }
          ],
          "hasAuthentication": true,
          "authorizationChecks": [
            {
              "type": "session_check",
              "location": "Line 21",
              "details": "const session = await getServerSession();"
            },
            {
              "type": "session_check",
              "location": "Line 23",
              "details": "if (!session) {\r\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n  }"
            },
            {
              "type": "session_check",
              "location": "Line 31",
              "details": "if (!checkSuperuser(session.user.role)) {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { st"
            },
            {
              "type": "role_check",
              "location": "Line 14",
              "details": "{\r\n  //custom role from config\r\n  return userRole === \"superuser\" || userRole === \"moderator\";\r\n}"
            },
            {
              "type": "role_check",
              "location": "Line 16",
              "details": "return userRole === \"superuser\" || userRole === \"moderator\";"
            }
          ]
        }
      ]
    },
    {
      "filePath": "data\\vuln-app\\app\\api\\tasks\\[id]\\route.ts",
      "method": [
        "PUT",
        "DELETE"
      ],
      "sinks": [
        {
          "type": "database_write",
          "location": "Line 59",
          "callPath": [
            "db.task.update"
          ]
        },
        {
          "type": "database_write",
          "location": "Line 80",
          "callPath": [
            "db.task.delete"
          ]
        }
      ],
      "hasAuthentication": true,
      "authorizationChecks": [
        {
          "type": "session_check",
          "location": "Line 37",
          "details": "const sessionUserId = getSessionUserId(request);"
        },
        {
          "type": "session_check",
          "location": "Line 38",
          "details": "if (!sessionUserId) {\r\n    return NextResponse.json(\r\n      { error: \"Unauthorized - Please log in\" "
        },
        {
          "type": "session_check",
          "location": "Line 50",
          "details": "if (task.userId !== sessionUserId) {\r\n    return NextResponse.json(\r\n      { error: \"Forbidden - You"
        }
      ],
      "parameters": [],
      "middleware": [],
      "methodDetails": [
        {
          "method": "PUT",
          "sinks": [
            {
              "type": "database_write",
              "location": "Line 59",
              "callPath": [
                "db.task.update"
              ],
              "isProtected": true
            }
          ],
          "hasAuthentication": true,
          "authorizationChecks": [
            {
              "type": "session_check",
              "location": "Line 37",
              "details": "const sessionUserId = getSessionUserId(request);"
            },
            {
              "type": "session_check",
              "location": "Line 38",
              "details": "if (!sessionUserId) {\r\n    return NextResponse.json(\r\n      { error: \"Unauthorized - Please log in\" "
            },
            {
              "type": "session_check",
              "location": "Line 50",
              "details": "if (task.userId !== sessionUserId) {\r\n    return NextResponse.json(\r\n      { error: \"Forbidden - You"
            }
          ]
        },
        {
          "method": "DELETE",
          "sinks": [
            {
              "type": "database_write",
              "location": "Line 80",
              "callPath": [
                "db.task.delete"
              ],
              "isProtected": false
            }
          ],
          "hasAuthentication": false,
          "authorizationChecks": []
        }
      ]
    },
    {
      "filePath": "data\\vuln-app\\app\\api\\tasks\\user-safe\\route.ts",
      "method": [
        "GET"
      ],
      "sinks": [
        {
          "type": "user_table_read",
          "location": "Line 24",
          "callPath": [
            "userQuery.findMany"
          ]
        }
      ],
      "hasAuthentication": true,
      "authorizationChecks": [
        {
          "type": "session_check",
          "location": "Line 2",
          "details": "import { getServerSession } from \"../../../../lib/session\";"
        },
        {
          "type": "session_check",
          "location": "Line 12",
          "details": "const session = getServerSession(\r\n    request,\r\n    securityConfig.sessionTokens.user\r\n  );"
        },
        {
          "type": "session_check",
          "location": "Line 14",
          "details": "securityConfig.sessionTokens.user"
        },
        {
          "type": "session_check",
          "location": "Line 17",
          "details": "if (!session) {\r\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n  }"
        },
        {
          "type": "session_check",
          "location": "Line 49",
          "details": "session.user.role !== \"admin\""
        }
      ],
      "parameters": [],
      "middleware": [],
      "methodDetails": [
        {
          "method": "GET",
          "sinks": [
            {
              "type": "user_table_read",
              "location": "Line 24",
              "callPath": [
                "userQuery.findMany"
              ],
              "isProtected": true
            }
          ],
          "hasAuthentication": true,
          "authorizationChecks": [
            {
              "type": "session_check",
              "location": "Line 12",
              "details": "const session = getServerSession(\r\n    request,\r\n    securityConfig.sessionTokens.user\r\n  );"
            },
            {
              "type": "session_check",
              "location": "Line 14",
              "details": "securityConfig.sessionTokens.user"
            },
            {
              "type": "session_check",
              "location": "Line 17",
              "details": "if (!session) {\r\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n  }"
            },
            {
              "type": "session_check",
              "location": "Line 49",
              "details": "session.user.role !== \"admin\""
            }
          ]
        }
      ]
    },
    {
      "filePath": "data\\vuln-app\\app\\api\\tasks\\user\\route.ts",
      "method": [
        "GET"
      ],
      "sinks": [
        {
          "type": "user_table_read",
          "location": "Line 44",
          "callPath": [
            "db.user.findMany"
          ]
        }
      ],
      "hasAuthentication": true,
      "authorizationChecks": [
        {
          "type": "session_check",
          "location": "Line 2",
          "details": "import { getServerSession } from \"../../../../lib/session\";"
        },
        {
          "type": "session_check",
          "location": "Line 33",
          "details": "const session = getServerSession(request);"
        },
        {
          "type": "session_check",
          "location": "Line 35",
          "details": "if (!session) {\r\n    return NextResponse.json(\r\n      { error: \"Unauthorized - Authentication requir"
        }
      ],
      "parameters": [],
      "middleware": [],
      "methodDetails": [
        {
          "method": "GET",
          "sinks": [
            {
              "type": "user_table_read",
              "location": "Line 44",
              "callPath": [
                "db.user.findMany"
              ],
              "isProtected": true
            }
          ],
          "hasAuthentication": true,
          "authorizationChecks": [
            {
              "type": "session_check",
              "location": "Line 33",
              "details": "const session = getServerSession(request);"
            },
            {
              "type": "session_check",
              "location": "Line 35",
              "details": "if (!session) {\r\n    return NextResponse.json(\r\n      { error: \"Unauthorized - Authentication requir"
            }
          ]
        }
      ]
    }
  ]
}